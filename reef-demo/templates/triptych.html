<div class="editor-holder">
  <div class="aspect-selector">
    <input type="radio" name="aspect-ratio" value="landscape" checked>
    <label for="aspect-ratio">16x9 Landscape</label>
    <input type="radio" name="aspect-ratio" value="portrait">
    <label for="aspect-ratio">16x9 Portrait</label>
    <input type="radio" name="aspect-ratio" value="carScreen">
    <label for="aspect-ratio">Car Screen</label>
  </div>
  <div class="layout-options">
  </div>
  <div class="triptych-images">
    <img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Aspect-ratio-4x3.svg" crossorigin="anonymous"> 
    <img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Aspect-ratio-4x3.svg" crossorigin="anonymous"> 
  </div>
  <canvas id="triptych-edit" width="480" height="270">
  </canvas>
  <input type="color" name="color-picker"><label for="color-picker">Background Color</label>
  <button class="choose-image">Choose This</button>
</div>
<style>
  .triptych-images {
    display: none;
  }
</style>
<script>
  let aspectRatios = {
    landscape: {
      width: 480, 
      height: 270,
      layouts: [[[10, 10, 160, 120], [10, 140, 160, 120], [180, 25, 292, 219]], [[15, 50, 220, 165], [245, 50, 220, 165]]],
    },
    portrait: {
      width: 270,
      height: 480,
      layouts: [],
    },
    carScreen: {
      width: 768,
      height: 270,
      layouts: [[[10, 10, 160, 120], [10, 140, 160, 120], [180, 15, 320, 240]]],
    }
  };
  let backgroundColor = 'black';
  let selectedRatio = 'landscape'
  let selectedLayout = 0;
  let triptych = document.querySelector('#triptych-edit');
  let ctx = triptych.getContext('2d');


  function renderTriptych(e) {
    let images = document.querySelectorAll('.triptych-images img');
    let height = triptych.height / 2;
    let width = triptych.width / 2;
    ctx.clearRect(0, 0, triptych.width, triptych.height);
    ctx.fillStyle = e ? e.target.value : backgroundColor;
    backgroundColor = ctx.fillStyle;
    ctx.fillRect(0, 0, triptych.width, triptych.height);
    images.forEach((img, idx) => {
      ctx.drawImage(img, 0, 0, img.width, img.height, ...aspectRatios[selectedRatio].layouts[selectedLayout][idx]);
    });
  }

  function renderOptions(ratio) {
    document.querySelector('.layout-options').innerHTML = aspectRatios[ratio].layouts.map((layout, i) => 
      `
      <input type="radio" name="triptych-options" value="${i}" ${i === 0 ? 'checked' : ''}>
      <label for="option${i}">${i}</label>
      `
    ).join('');
  }

  function getImageFromCanvas() {
    let triptych = document.querySelector('#triptych-edit');
    let src = triptych.toDataURL('img/jpeg');  
    let newImg = document.createElement('img');
    newImg.src = src;
    document.querySelector('.editor-holder').appendChild(newImg);
  }

  function changeAspect(e) {
    let triptych = document.querySelector('#triptych-edit');
    let vals = aspectRatios[e.target.value];
    triptych.width = vals.width;
    triptych.height = vals.height;
    selectedRatio = e.target.value;
    ctx.clearRect(0, 0, triptych.width, triptych.height);
    ctx.fillStyle = backgroundColor;
    ctx.fillRect(0, 0, triptych.width, triptych.height);
    renderOptions(selectedRatio);
    renderTriptych();
  }

  function chooseTriptych(e) {
    console.log('e.target', e.target.value);
  }

  renderOptions(selectedRatio);
  renderTriptych();

  document.querySelector('.choose-image').onclick = getImageFromCanvas;
  document.querySelector('[name=color-picker]').oninput = renderTriptych;
  document.querySelector('.aspect-selector').onchange = changeAspect;
  document.querySelector('.layout-options').onchange = chooseTriptych;
</script>
