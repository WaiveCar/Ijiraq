<div class="editor-holder">
  <input type="color" name="background-color-picker"><label for="background-color-picker">Background Color</label>
  <div class="category-selector">
    <input type="radio" name="post-category" value="announcement" checked>
    <label for="post-category">Announcement</label>
    <input type="radio" name="post-category" value="promo">
    <label for="post-category">Promo</label>
    <input type="radio" name="post-category" value="notice">
    <label for="post-category">Notice</label>
  </div>
  <div class="layout-options">
  </div>
  <div class="triptych-images">
    <img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Aspect-ratio-4x3.svg" crossorigin="anonymous"> 
    <img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Aspect-ratio-4x3.svg" crossorigin="anonymous"> 
    <img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Aspect-ratio-4x3.svg" crossorigin="anonymous"> 
    <img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Aspect-ratio-4x3.svg" crossorigin="anonymous"> 
    <img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Aspect-ratio-4x3.svg" crossorigin="anonymous"> 
    <img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Aspect-ratio-4x3.svg" crossorigin="anonymous"> 
    <img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Aspect-ratio-4x3.svg" crossorigin="anonymous"> 
    <img src="https://upload.wikimedia.org/wikipedia/commons/d/de/Aspect-ratio-4x3.svg" crossorigin="anonymous"> 
  </div>
  <button class="add-text">Add Text</button>
  <input type="color" name="text-color-picker"><label for="text-color-picker">Text Color</label>
  <input type="text" class="triptych-text" placeholder="enter text">
  <button class="clear-text">Clear Text</button>
  <div>
    <canvas id="triptych-edit" width="768" height="270">
    </canvas>
  </div>
  <button class="choose-image">Choose This</button>
</div>
<style>
  .triptych-images {
    display: none;
  }
  #triptych-edit {
    border: 1px solid black;
  }
</style>
<script>
  let postTypes = {
    announcement: {
      layouts: [
        [
          [10, 10, 160, 120],
          [10, 140, 160, 120],
          [224, 15, 320, 240],
          [598, 10, 160, 120],
          [598, 140, 160, 120],
        ],
        [[16, 45, 240, 180], [264, 45, 240, 180], [512, 45, 240, 180]],
        [
          [32, 45, 240, 180],
          [304, 45, 240, 180],
          [576, 15, 160, 120],
          [576, 140, 160, 120],
        ],
      ],
    },
    promo: {
      layouts: [
        [
          [10, 10, 160, 120],
          [10, 140, 160, 120],
          [224, 15, 320, 240],
          [598, 10, 160, 120],
          [598, 140, 160, 120],
        ],
        [[16, 45, 240, 180], [264, 45, 240, 180], [512, 45, 240, 180]],
        [
          [32, 45, 240, 180],
          [304, 45, 240, 180],
          [576, 15, 160, 120],
          [576, 140, 160, 120],
        ],
      ],
    },
    notice: {
      layouts: [
        [
          [10, 10, 160, 120],
          [10, 140, 160, 120],
          [224, 15, 320, 240],
          [598, 10, 160, 120],
          [598, 140, 160, 120],
        ],
        [[16, 45, 240, 180], [264, 45, 240, 180], [512, 45, 240, 180]],
        [
          [32, 45, 240, 180],
          [304, 45, 240, 180],
          [576, 15, 160, 120],
          [576, 140, 160, 120],
        ],
      ],
    },
  };

  let backgroundColor = 'white';
  let selectedCategory = 'announcement';
  let selectedLayout = 0;
  let addingText = false;
  let triptych = document.querySelector('#triptych-edit');
  let ctx = triptych.getContext('2d');
  
  function renderTriptych(e) {
    let images = document.querySelectorAll('.triptych-images img');
    let height = triptych.height / 2;
    let width = triptych.width / 2;
    ctx.clearRect(0, 0, triptych.width, triptych.height);
    ctx.fillStyle = e ? e.target.value : backgroundColor;
    backgroundColor = ctx.fillStyle;
    ctx.fillRect(0, 0, triptych.width, triptych.height);
    postTypes[selectedCategory].layouts[selectedLayout].forEach((place, i) => {
      ctx.drawImage(images[i], 0, 0, images[i].width, images[i].height, ...place);
    });
  }
  
  function renderOptions(ratio) {
    document.querySelector('.layout-options').innerHTML = postTypes[
      ratio
    ].layouts
      .map(
        (layout, i) =>
          `
        <input type="radio" name="triptych-options" value="${i}" ${
            i === 0 ? 'checked' : ''
          }>
        <label for="option${i}">${i}</label>
        `,
      )
      .join('');
  }
  
  function getImageFromCanvas() {
    let triptych = document.querySelector('#triptych-edit');
    let src = triptych.toDataURL('img/jpeg');
    let newImg = document.createElement('img');
    newImg.src = src;
    document.querySelector('.editor-holder').appendChild(newImg);
  }
  
  function changeCategory(e) {
    let triptych = document.querySelector('#triptych-edit');
    let vals = postTypes[e.target.value];
    selectedCategory = e.target.value;
    ctx.clearRect(0, 0, triptych.width, triptych.height);
    ctx.fillStyle = backgroundColor;
    ctx.fillRect(0, 0, triptych.width, triptych.height);
    renderOptions(selectedCategory);
    selectedLayout = 0;
    renderTriptych();
  }
  
  function chooseTriptych(e) {
    selectedLayout = Number(e.target.value);
    renderTriptych();
  }
  
  function handleCanvasText(e) {
    let text = document.querySelector('.triptych-text').value;
    let textColor = document.querySelector('[name=text-color-picker]').value;
    let rect = triptych.getBoundingClientRect();
    ctx.font = '30px Arial';
    ctx.fillStyle = textColor;
    ctx.fillText(text, e.clientX - rect.left, e.clientY - rect.top);
    ctx.fillStyle = backgroundColor;
  }
  
  function toggleTextAdd() {
    if (this.textContent === 'Add Text') {
      this.textContent = 'Cancel Adding Text';
      triptych.addEventListener('click', handleCanvasText);
    } else {
      this.textContent = 'Add Text';
      triptych.removeEventListener('click', handleCanvasText);
    }
  }
  
  renderOptions(selectedCategory);
  renderTriptych();
  
  document.querySelector('.choose-image').onclick = getImageFromCanvas;
  document.querySelector('[name=background-color-picker]').oninput = renderTriptych;
  document.querySelector('.category-selector').onchange = changeCategory;
  document.querySelector('.layout-options').onchange = chooseTriptych;
  document.querySelector('.add-text').onclick = toggleTextAdd;
  document.querySelector('.clear-text').onclick = renderTriptych;
</script>
